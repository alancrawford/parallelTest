source ~/.bash_profile

module load sge/2011.11
module load openmpi/gcc/64/1.4.5
module load r/3.1.3

#
#$ -q batch.q 
#$ -cwd
#$ -o rmpi.out  
#$ -j y 
#$ -S /bin/bash 
#$ -N rmpi8
#$ -pe openmpi 8

tmphosts=`mktemp`
awk '{ for (i=0; i < $2; ++i) { print $1} }' $PE_HOSTFILE > $tmphosts

echo "Got $NSLOTS slots"
echo "jobid $JOB_ID"

echo "checking environment:"
echo "====================="

echo "your LD_LIBRARY"
echo $LD_LIBRARY_PATH

echo "your hostfile:"
echo $PE_HOSTFILE

echo "your tmphost:"
echo $tmphosts

mpirun -np $NSLOTS -machinefile $tmphosts R --no-save -q < Rmpitest.R > rmpi.Rout
